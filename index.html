<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Marketing Cloud API Helper</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://*.marketingcloudapis.com https://*.exacttarget.com https://www.googleapis.com">
  <!-- Enlaza la hoja de estilos principal -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="license-modal-overlay" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3>Acceso a la Aplicaci√≥n</h3>
        <p>Por favor, introduce tu email y la clave de acceso para activar la herramienta.</p>
        <p id="license-error-message" class="error-text" style="display: none;"></p>
        <form id="license-form" class="config-section-container" style="padding: 0;">
            <div class="form-group">
                <label for="license-email">Email de registro</label>
                <input type="email" id="license-email" required>
            </div>
            <div class="form-group">
                <label for="license-key">Clave de Acceso</label>
                <input type="password" id="license-key" required>
            </div>
            <div class="modal-actions" style="margin-top: 10px;">
                <button type="submit" id="license-submit-btn" class="action-button">Validar y Acceder</button>
            </div>
        </form>
    </div>
</div>
  <div id="loader-overlay" class="loader-overlay" style="display: none;">
    <div class="loader-spinner"></div>
    <p id="loader-text" class="loader-text">Cargando...</p>
  </div>

<!-- ===================================================================
     CONTENEDOR PRINCIPAL DE LA APLICACI√ìN
     Utiliza CSS Grid para definir la estructura de 3 columnas.
     =================================================================== -->
<div class="app-container">
  
  <!-- ========================================================== -->
  <!-- START: BARRA LATERAL IZQUIERDA (NAVEGACI√ìN) -->
  <!-- ========================================================== -->
  <aside id="macros-sidebar">
    
    <!-- Selector de Cliente y Estado de Sesi√≥n -->
    <div class="sidebar-client-selector">
      <h2>Cliente</h2>
      <select id="sidebarClientSelect">
        <option value="">Ninguno seleccionado</option>
      </select>
      <p id="login-status" class="login-status inactive">üî¥ Sesi√≥n no iniciada</p>
    </div>
    
    <h2>Vistas</h2>
    
    <!-- Men√∫s colapsables para agrupar las funcionalidades de la aplicaci√≥n -->
    <div class="collapsible-group">
        <h3 class="collapsible-header">General</h3>
        <ul class="collapsible-content">
          <li><a class="macro-item" data-macro="docu">Documentaci√≥n</a></li>
          <li><a class="macro-item" data-macro="configuracionAPIs">Configuraci√≥n de APIs</a></li>
        </ul>
    </div>

    <div class="collapsible-group">
        <h3 class="collapsible-header">Data Extensions</h3>
        <ul class="collapsible-content">
          <li><a class="macro-item" data-macro="configuracionDE">Configuraci√≥n de Data Extension</a></li>
          <li><a class="macro-item" data-macro="campos">Campos</a></li>
          <li><a class="macro-item" data-macro="gestionCampos">Recuperaci√≥n y Borrado de Campos</a></li>
        </ul>
    </div>

    <div class="collapsible-group">
        <h3 class="collapsible-header">Funcionalidades</h3>
        <ul class="collapsible-content">
          <li><a class="macro-item" data-macro="calendario">Calendario</a></li>
          <li><a class="macro-item" data-macro="validadorEmail">Validador de Email</a></li>
          <li><a class="macro-item" data-macro="buscadores">Buscadores</a></li>
          <li><a class="macro-item" data-macro="gestionAutomatismos">Gesti√≥n de automatismos</a></li> 
          <li><a class="macro-item" data-macro="gestionJourneys">Gesti√≥n de Journeys</a></li> 
        </ul>
    </div>
  </aside>
  <!-- END: BARRA LATERAL IZQUIERDA -->

  <!-- ========================================================== -->
  <!-- START: CONTENIDO PRINCIPAL (VISTAS) -->
  <!-- ========================================================== -->
  <main id="main-content">
    
    <!-- 1. PANTALLA DE BIENVENIDA (MEN√ö PRINCIPAL) -->
    <div id="main-menu" class="main-menu-container" style="display: flex;">
      <div class="menu-group">
        <h3>Panel Principal</h3>
        <div class="menu-buttons-container">
         <p class="info-text">
            Bienvenido a Marketing Cloud API Helper.
         </p>
         <p class="info-text">
            Para empezar, configura un cliente en "Configuraci√≥n de APIs". Al pulsar en login (o seleccion√°ndolo si ya estaba guardado) se iniciar√° el proceso de autenticaci√≥n.
         </p>
        </div>
      </div>
    </div>

    <!-- 2. SECCI√ìN: DOCUMENTACI√ìN -->
    <div id="documentacion-section" class="section">
      <div class="section-header"><button class="back-button">‚Üê Atr√°s</button></div>
      <h2>Documentaci√≥n y Gu√≠a de Uso</h2>
      
      <div class="tabs-container docu-container">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="configuracion-principal">Primeros Pasos</button>
          <button class="tab-button" data-tab="guia-rapida">Gu√≠a R√°pida</button>
          <button class="tab-button" data-tab="errores-comunes">Errores Comunes</button>
          <button class="tab-button" data-tab="comentarios-adicionales">Comentarios</button>
        </div>
        
        <!-- Pesta√±a: Primeros Pasos -->
        <div id="configuracion-principal" class="tab-content active">
          <ul class="docu-list">
            <li>
              <div class="docu-item-header">
                <span class="docu-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" /><path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" /></svg>
                </span>
                <strong>Paso 1: Configurar la Aplicaci√≥n en Marketing Cloud</strong>
              </div>
              <ul>
                <li>Ve a <b>Setup ‚Üí Apps ‚Üí Installed Packages</b>.</li>
                <li>Crea un nuevo paquete de tipo <b>Web App</b>.</li>
                <li>Si es <b>Web App</b>, el Callback URI debe ser <code>https://127.0.0.1:8443/callback</code>.</li>
                <li>En el componente de API, asigna estos permisos:
                  <ul class="docu-permissions">
                    <li><b>Email:</b> Read, Write</li>
                    <li><b>Automations:</b> Read, Write, Execute</li>
                    <li><b>Journeys:</b> Read, Write, Activate/Stop/Pause/Resume/Send/Schedule, Delete</li>
                    <li><b>Audiences:</b> Read, Write</li>
                    <li><b>List and Subscribers:</b> Read, Write</li>
                    <li><b>Data Extensions:</b> Read, Write</li>
                  </ul>
                </li>
                <div class="docu-callout info">
                  <b>IMPORTANTE:</b> La aplicaci√≥n en Marketing Cloud puede tardar hasta 10 minutos en estar completamente operativa despu√©s de guardarla.
                </div>
              </ul>
            </li>
            <li>
              <div class="docu-item-header">
                <span class="docu-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M9 7h1" /><path d="M9 13h6" /><path d="M9 17h6" /></svg>
                </span>
                <strong>Paso 2: Configurar un Cliente en esta App</strong>
              </div>
              <ul>
                <li>Ve a la vista de <b>Configuraci√≥n de APIs</b>.</li>
                <li>Introduce un nombre para el cliente (ej: "Cliente X - Producci√≥n").</li>
                <li>Rellena los datos (MID, Auth URI, Client ID, etc.) obtenidos del paso anterior.</li>
                <li>Pulsa <b>"Guardar"</b>. La configuraci√≥n quedar√° almacenada en tu equipo.</li>
                <li>Pulsa <b>"Login"</b> para iniciar la sesi√≥n. Se abrir√° una ventana de Salesforce para que te autentiques.</li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Pesta√±a: Gu√≠a R√°pida -->
        <div id="guia-rapida" class="tab-content">
          <ol class="docu-list ordered">
            <li><b>Configuraci√≥n de DE:</b> Define el nombre, carpeta y si ser√° "Sendable".</li>
            <li><b>Campos:</b> A√±ade campos manualmente, con el bot√≥n de ejemplos o importando desde Excel/Sheets.</li>
            <li><b>Crear DE / Campos:</b> Usa "Crear Data Extension" para DEs nuevas o "Crear/Actualizar Campos" para modificar una existente.</li>
            <li><b>Gesti√≥n de Campos:</b> Herramienta para recuperar o eliminar campos de una DE. Muy √∫til para campos en Attribute Groups que no se pueden borrar desde la interfaz de MC.</li>
            <li><b>Calendario:</b> Visualiza los automatismos programados. Un bot√≥n muestra todos, y el otro filtra solo los que contienen un Journey.</li>
            <li><b>Buscadores:</b> Un potente conjunto de herramientas para encontrar DEs por su nombre (incluso parcial), el origen de sus datos, buscar texto dentro de todas las Queries, y localizar clientes.</li>
            <li><b>Gesti√≥n de automatismos:</b> Permite buscar, filtrar y realizar acciones masivas (Activar, Ejecutar, Parar) sobre los automatismos.</li>
          </ol>
        </div>

        <!-- Pesta√±a: Errores Comunes -->
        <div id="errores-comunes" class="tab-content">
          <ul class="docu-list">
            <li>
              <div class="docu-item-header">
                <span class="docu-icon warning">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 9v4" /><path d="M10.36 15.64a2 2 0 1 1 3.28 0" /><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" /></svg>
                </span>
                <strong>Error de autenticaci√≥n</strong>
              </div>
              <p>Revisa que el MID, Client ID y Client Secret sean correctos. La URI de autenticaci√≥n debe terminar en <code>/v2/token</code>.</p>
            </li>
            <li>
              <div class="docu-item-header">
                <span class="docu-icon warning">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 9v4" /><path d="M10.36 15.64a2 2 0 1 1 3.28 0" /><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" /></svg>
                </span>
                <strong>La DE se crea en la carpeta ra√≠z</strong>
              </div>
              <p>Para crear una DE en una carpeta espec√≠fica, debes usar su <b>ID num√©rico</b>, no su nombre.</p>
            </li>
            <li>
              <div class="docu-item-header">
                <span class="docu-icon warning">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 9v4" /><path d="M10.36 15.64a2 2 0 1 1 3.28 0" /><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" /></svg>
                </span>
                <strong>DE Sendable sin Subscriber Key</strong>
              </div>
              <p>Es <b>obligatorio</b> seleccionar un campo como "Campo SubscriberKey" si marcas la casilla "Es Sendable".</p>
            </li>
          </ul>
        </div>
        
        <!-- Pesta√±a: Comentarios Adicionales -->
        <div id="comentarios-adicionales" class="tab-content">
          <ul class="docu-list">
            <li>
              <div class="docu-item-header">
                <span class="docu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 11h-2a2 2 0 1 0 0 4h2v-4z" /><path d="M18 11h-2a2 2 0 1 0 0 4h2v-4z" /><path d="M3 11v4" /><path d="M21 11v4" /><path d="M13 11v4" /><path d="M5 15v-2a3 3 0 0 1 3 -3h8a3 3 0 0 1 3 3v2" /><path d="M12 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /></svg>
                </span>
                <strong>Permisos de API</strong>
              </div>
              <p>Aseg√∫rate de que la aplicaci√≥n API en Marketing Cloud tenga permisos de <b>Lectura y Escritura</b> para los objetos que quieres gestionar.</p>
            </li>
            <li>
              <div class="docu-item-header">
                <span class="docu-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                </span>
                <strong>"Crear/Actualizar campos" es un "upsert"</strong>
              </div>
              <p>Esta acci√≥n actualiza campos que ya existen o crea los que son nuevos, sin borrar los que no est√°n en la tabla.</p>
            </li>
            <li>
              <div class="docu-item-header">
                <span class="docu-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-decimal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 15h-5a2 2 0 1 0 0 4h5" /><path d="M12 11v8" /><path d="M8 10h.01" /></svg>
                </span>
                <strong>Longitud en campos Decimales</strong>
              </div>
              <p>Para campos de tipo Decimal, usa el formato "total_d√≠gitos,n√∫mero_decimales", por ejemplo, <code>18,2</code>.</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- 3. SECCI√ìN: CONFIGURACI√ìN DE APIS -->
    <div id="configuracion-apis-section" class="section config-section-container">
         <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions">
                <button id="saveConfigBtn" class="action-button">Guardar</button>
                <button id="loginBtn" class="action-button">Login</button>
                <button id="logoutBtn" class="action-button delete-btn">Logout / Borrar</button>
            </div>            
        </div>
        <h2>Configuraci√≥n de APIs</h2>
        <!-- Gesti√≥n de Clientes (Crear, Seleccionar) -->
        <div class="client-management">
            <input type="text" id="clientName" placeholder="Nombre del Cliente">
            <select id="savedConfigs">
                <option value="">Seleccionar configuraci√≥n...</option>
            </select>
        </div>
        <!-- Datos de la Aplicaci√≥n API -->
        <div class="config-block">
            <h3>Datos Aplicaci√≥n</h3>
            <div class="form-group"><label for="businessUnit">Business Unit (MID)</label><input type="text" id="businessUnit"></div>
            <div class="form-group"><label for="authUri">Auth URI</label><input type="text" id="authUri" placeholder="Ej: https://...mc.auth.marketingcloudapis.com/v2/token"></div>
            <div class="form-group"><label for="clientId">Client ID</label><input type="text" id="clientId"></div>
            <div class="form-group"><label for="clientSecret">Client Secret</label><input type="password" id="clientSecret" placeholder="Necesario para el primer login"></div>
            <div class="form-group"><label for="token">Access Token</label><input type="text" id="token" disabled></div>
            <div class="form-group"><label for="soapUri">SOAP URI</label><input type="text" id="soapUri" disabled></div>
            <div class="form-group"><label for="restUri">REST URI</label><input type="text" id="restUri" disabled></div>
            <div class="form-group"><label for="stackKey">Stack</label><input type="text" id="stackKey" disabled></div>
        </div>
        <!-- Configuraci√≥n de Data Views para el buscador de env√≠os -->
        <div class="config-block">
          <h3>B√∫squeda Din√°mica en Data Extensions</h3>
          <p class="info-text" style="text-align: left; margin: 0 0 15px;">
              Configura las tablas donde se buscar√° al cliente al pulsar el bot√≥n "DEs". Los cambios se guardan junto con el resto de la configuraci√≥n.
          </p>
          <div class="table-container">
              <table id="sends-config-table">
                  <thead>
                      <tr>
                          <th>Nombre</th>
                          <th>External Key</th>
                          <th>Campo de B√∫squeda</th>
                      </tr>
                  </thead>
                  <tbody id="sends-config-tbody">
                      <!-- Las filas se a√±adir√°n/cargar√°n din√°micamente aqu√≠ -->
                  </tbody>
              </table>
          </div>
          <div class="header-actions" style="justify-content: flex-start; margin-top: 15px;">
              <button id="add-send-config-row-btn" class="action-button">A√±adir Fila</button>
          </div>
      </div>
    </div>

    <!-- 4. SECCI√ìN: CONFIGURACI√ìN DE DATA EXTENSION (Creaci√≥n) -->
    <div id="configuracion-de-section" class="section config-section-container">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions"><button id="createDE" class="action-button">Crear Data Extension</button></div>
        </div>
        <h2>Configuraci√≥n de Data Extension</h2>
        <!-- Configuraci√≥n Base de la DE -->
        <div class="config-block">
            <h3>Configuraci√≥n Base</h3>
            <div class="form-group"><label for="deName">Nombre Data Extension</label><input type="text" id="deName"></div>
            <div class="form-group"><label for="deDescription">Descripci√≥n</label><input type="text" id="deDescription"></div>
            <div class="form-group"><label for="deExternalKey">External Key</label><input type="text" id="deExternalKey" disabled></div>
            <div class="form-group"><label for="deFolder">ID de Carpeta (Opcional)</label><input type="text" id="deFolder" placeholder="Ej: 12345"></div>
        </div>
        <!-- Configuraci√≥n Sendable -->
        <div class="config-block">
            <h3>Configuraci√≥n Sendable</h3>
            <div class="form-group checkbox-group">
                <label for="isSendable">Es Sendable:</label><input type="checkbox" id="isSendable">
            </div>
            <div class="form-group">
                <label for="subscriberKeyField">Campo SubscriberKey</label>
                <select id="subscriberKeyField" disabled><option value="">-- Defina campos en la secci√≥n 'Campos' --</option></select>
            </div>
            <div class="form-group"><label for="subscriberKeyType">Tipo Campo SubscriberKey</label><input type="text" id="subscriberKeyType" disabled></div>
        </div>
    </div>

    <!-- 5. SECCI√ìN: CAMPOS DE LA DATA EXTENSION -->
    <div id="campos-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions">
                <button id="importFieldsBtn" class="action-button">Importar</button>                
                <button id="createFieldsBtn" class="action-button activate-btn">Crear/Actualizar Campos</button>
                <button id="createDummyFieldsBtn" class="action-button">Campos de Ejemplo</button>                
                <button id="clearFieldsBtn" class="action-button delete-btn">Limpiar Tabla</button>
            </div>
        </div>
        <h2>Campos de la Data Extension</h2>
        <div class="table-container">
          <table id="myTable">
            <thead>
              <tr><th>Campo MC</th><th>Tipo Campo</th><th>Longitud</th><th>Default</th><th>PK</th><th>Requerido</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <!-- Botones para mover filas seleccionadas -->
          <div class="control-buttons">
            <button id="addFieldBtn" class="action-button">A√±adir Fila</button>
            <button id="moveUp" title="Mover fila seleccionada hacia arriba">‚ñ≤</button>
            <button id="moveDown" title="Mover fila seleccionada hacia abajo">‚ñº</button>
          </div>
        </div>
    </div>
    
    <!-- 6. SECCI√ìN: GESTI√ìN DE CAMPOS (Recuperar/Borrar) -->
    <div id="configuracion-campos-section" class="section config-section-container">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions">
                <button id="getFields" class="action-button">Recuperar Campos</button>
                <button id="documentDEsBtn" class="action-button">Documentar Data Extensions</button>
                <button id="deleteField" class="action-button delete-btn">Borrar Campo</button>
            </div>
        </div>
        <h2>Gesti√≥n de Campos de Data Extension</h2>
        <div class="config-block">
            <h3>Par√°metros para recuperaci√≥n de 1 DE, Actualizaci√≥n de tabla de campos y Borrado</h3>
            <p class="info-text" style="text-align: left; margin: 0 0 15px;">
                Introduce la External Key de la DE sobre la que quieres operar y pulsa en <em>Recuperar Campos</em>.  Estos se rellenar√°n en la picklist y en la secci√≥n <em>Campos</em>.
            </p>
            <div class="form-group">
                <label for="recExternalKey">External Key de la DE</label>
                <input type="text" id="recExternalKey">
            </div>
            <div class="form-group">
                <label for="targetFieldSelect">Campo a eliminar</label>
                <select id="targetFieldSelect" disabled><option value="">-- Pulsa "Recuperar Campos" --</option></select>
            </div>
        </div>
        <div class="config-block">
            <h3>Par√°metros para generaci√≥n de CSV con las DEs y sus campos </h3>
            <p class="info-text" style="text-align: left; margin: 0 0 15px;">
                Introduce un identificador de carpeta y pulsa en <em>Documentar Data Extensions</em>
            </p>
            <div class="form-group">
                <label for="recCategoryId">Identificador de carpeta</label>
                <input type="text" id="recCategoryId">
            </div>
        </div>
    </div>

    <!-- 7. SECCI√ìN: CALENDARIO DE AUTOMATIZACIONES -->
    <div id="calendario-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
             <div class="calendar-controls">
                <label for="calendarYearSelect">A√±o:</label>
                <select id="calendarYearSelect"></select>
                <button id="refreshAutomationsBtn" class="action-button">Refrescar Automatismos</button>
                <button id="refreshJourneyAutomationsBtn" class="action-button activate-btn">Refrescar Automatismos de Journeys</button>
            </div>
        </div>
        <div class="calendar-container">
            <!-- Rejilla de meses del calendario -->
            <div id="calendar-main" class="calendar-main-view">
                <h2>Calendario de Automatizaciones</h2>
                <div id="calendar-grid" class="calendar-grid"></div>
            </div>
            <!-- Barra lateral para mostrar detalles del d√≠a seleccionado -->
            <aside id="calendar-sidebar" class="calendar-sidebar">
                <h3 id="automation-list-header">Automatizaciones del D√≠a</h3>
                <div id="automation-list">
                    <p>Selecciona un d√≠a para ver los detalles.</p>
                </div>
            </aside>
        </div>
    </div>

    <!-- 8. SECCI√ìN: VALIDADOR DE EMAIL -->
    <div id="email-validator-section" class="section config-section-container">
        <div class="section-header"><button class="back-button">‚Üê Atr√°s</button></div>
        <h2>Validador de Email</h2>
        <div class="config-block">
            <h3>Par√°metros de Validaci√≥n</h3>
            <div class="form-group">
              <label for="emailToValidate">Email a validar:</label>
              <input type="text" id="emailToValidate" placeholder="Introduce la direcci√≥n de email">
            </div>
            <div class="header-actions" style="justify-content: center; margin-top: 20px;">
               <button id="validateEmailBtn" class="action-button">Validar Email</button>
            </div>
        </div>
        <div class="config-block">
            <h3>Resultado de la Validaci√≥n</h3>
            <pre id="email-validation-results">El resultado aparecer√° aqu√≠.</pre>
        </div>
    </div>

    <!-- 9. SECCI√ìN: BUSCADORES -->
    <div id="buscadores-section" class="section">
      <div class="section-header"><button class="back-button">‚Üê Atr√°s</button></div>
      <h2>Buscadores</h2>
      <!-- Contenedor de pesta√±as para los diferentes tipos de b√∫squeda -->
      <div class="tabs-container">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="busqueda-de-tab">Data Extensions</button>
          <button class="tab-button" data-tab="origenes-tab">Origen de datos</button>
          <button class="tab-button" data-tab="clientes-tab">Clientes</button>
          <button class="tab-button" data-tab="queries-tab">Texto en Queries</button>
        </div>

        <!-- Pesta√±a: B√∫squeda de Data Extension -->
        <div id="busqueda-de-tab" class="tab-content active config-section-container">
            <div class="config-block">
                <h3>Par√°metros de B√∫squeda</h3>
                <div class="form-group">
                    <label for="deSearchProperty">Buscar por:</label>
                    <select id="deSearchProperty">
                        <option value="Name">Nombre</option>
                        <option value="CustomerKey">External Key</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="deSearchValue">Valor:</label>
                    <input type="text" id="deSearchValue" placeholder="Ingresa el valor de b√∫squeda" maxlength="128">
                </div>
                <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="searchDEBtn" class="action-button">Buscar</button>
                </div>
            </div>
             <div class="config-block" style="flex-grow: 1;">
                  <h3>Resultados</h3>
                  <div class="table-container">
                      <table id="de-search-results-table">
                          <thead>
                              <tr>
                                  <th>Nombre Data Extension</th>
                                  <th>Ruta de Carpeta</th>
                              </tr>
                          </thead>
                          <tbody id="de-search-results-tbody"></tbody>
                      </table>
                  </div>
              </div>
        </div>

        <!-- Pesta√±a: Buscador de Or√≠genes de Datos -->
        <div id="origenes-tab" class="tab-content config-section-container">
            <div class="config-block">
                <h3>Par√°metros de B√∫squeda</h3>
                <div class="form-group">
                    <label for="deNameToFind">Nombre de la Data Extension:</label>
                    <input type="text" id="deNameToFind" placeholder="Introduce el nombre exacto de la DE">
                </div>
                <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="findDataSourcesBtn" class="action-button">Buscar Or√≠genes</button>
                </div>
            </div>
            <div class="config-block" style="flex-grow: 1;">
                <h3>Actividades Encontradas</h3>
                <div class="table-container">
                    <table id="data-sources-table">
                        <thead>
                            <tr>
                                <th>Actividad</th><th>Tipo</th><th>Automatizaci√≥n</th>
                                <th>Paso</th><th>Acci√≥n</th><th>Descripci√≥n / Query</th>
                            </tr>
                        </thead>
                        <tbody id="data-sources-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Pesta√±a: Buscador de Clientes (Suscriptores) -->
        <div id="clientes-tab" class="tab-content config-section-container">
            <div class="config-block">
                <h3>Par√°metros de B√∫squeda</h3>
                <div class="form-group">
                    <label for="customerSearchValue">Buscar por Subscriber Key o Email:</label>
                    <input type="text" id="customerSearchValue" placeholder="Ingresa el valor a buscar">
                </div>
                <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="searchCustomerBtn" class="action-button">Buscar Cliente</button>
                </div>
            </div>
            <!-- Bloque de Resultados de la B√∫squeda -->
            <div class="config-block" style="flex-grow: 1;">
                <div class="config-block-header">
                    <h3>Resultados</h3>
                    <div class="header-actions">
                        <button id="getDEsBtn" class="action-button" disabled>DEs</button>
                        <button id="getCustomerJourneysBtn" class="action-button" disabled>Journeys</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="customer-search-table">
                        <thead>
                            <tr>
                                <th>Subscriber Key</th><th>Email</th><th>Estado</th>
                                <th>Fecha Creaci√≥n</th><th>Fecha Baja</th><th>Es Suscriptor</th>
                            </tr>
                        </thead>
                        <tbody id="customer-search-tbody"></tbody>
                    </table>
                </div>
            </div>
            <!-- Bloque de Resultados de Journeys (oculto por defecto) -->
            <div id="customer-journeys-results-block" class="config-block hidden">
                <h3>Journeys del Cliente Seleccionado</h3>
                <div class="table-container">
                    <table id="customer-journeys-table">
                        <thead>
                            <tr>
                                <th>Nombre del Journey</th><th>ID</th><th>Definition Key</th>
                                <th>Versi√≥n</th><th>Fecha Creaci√≥n</th><th>Fecha Modificaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="customer-journeys-tbody"></tbody>
                    </table>
                </div>
            </div>
            <!-- Bloque de Resultados de Env√≠os (oculto por defecto) -->
            <div id="customer-sends-results-block" class="config-block hidden">
                <h3>Resultados de B√∫squeda en Data Extensions</h3>
                <div id="sends-results-container">
                    <!-- Los resultados se inyectar√°n aqu√≠ din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Pesta√±a: Buscador de Texto en Queries -->
        <div id="queries-tab" class="tab-content config-section-container">
            <div class="config-block">
                <h3>Par√°metros de B√∫squeda</h3>
                <div class="form-group">
                    <label for="querySearchText">Texto a buscar en la Query:</label>
                    <input type="text" id="querySearchText" placeholder="Ej: _Subscribers o Nombre_DE">
                </div>
                <div class="form-group checkbox-group" style="justify-content: flex-start;">
                    <label for="showQueryTextCheckbox">Mostrar Query Text:</label>
                    <input type="checkbox" id="showQueryTextCheckbox" checked>
                </div>
                <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="searchQueriesByTextBtn" class="action-button">Buscar en Queries</button>
                </div>
            </div>
            <div class="config-block" style="flex-grow: 1;">
                <h3>Queries Encontradas</h3>
                <div class="table-container">
                    <table id="query-search-results-table">
                        <thead>
                            <tr>
                                <th>Nombre de la Query</th><th>Automatizaci√≥n</th>
                                <th>Paso</th><th>Query Text</th>
                            </tr>
                        </thead>
                        <tbody id="query-search-results-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
      </div>
    </div>
    
    <!-- 10. SECCI√ìN: GESTI√ìN DE AUTOMATISMOS -->
    <div id="gestion-automatismos-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>            
            <div class="header-actions">
                <button id="refreshAutomationsTableBtn" class="action-button">Refrescar</button>
                <button id="activateAutomationBtn" class="action-button activate-btn" disabled>Activar</button>
                <button id="runAutomationBtn" class="action-button" disabled>Ejecutar</button>
                <button id="stopAutomationBtn" class="action-button delete-btn" disabled>Parar</button>
            </div>
        </div>
        <h2>Gesti√≥n de Automatismos</h2>
        <!-- Filtros para la tabla de automatismos -->
        <div class="header-filters">
            <input type="text" id="automationNameFilter" class="filter-input" placeholder="Buscar por nombre...">
            <select id="automationStatusFilter" class="filter-input">
                <option value="">Todos los estados</option>
            </select>
        </div>
        <div class="table-container">
          <table id="automations-table">
            <thead>
              <tr>
                <th class="sortable-header" data-sort-by="name">Nombre</th>
                <th class="sortable-header" data-sort-by="lastRunTime">√öltima Ejecuci√≥n</th>
                <th class="sortable-header" data-sort-by="schedule.scheduledTime">Pr√≥xima Ejecuci√≥n</th>
                <th class="sortable-header" data-sort-by="status">Estado</th>
              </tr>
            </thead>
            <tbody id="automations-tbody"></tbody>
          </table>
        </div>
          <div id="pagination-automations" class="pagination-controls">
            <button id="prevPageBtnAutomations" class="action-button pagination-arrow">&laquo;</button>
            <input type="number" id="pageInputAutomations" class="filter-input page-input" min="1">
            <span id="totalPagesAutomations">/ 1</span>
            <button id="nextPageBtnAutomations" class="action-button pagination-arrow">&raquo;</button>
          </div>
    </div>
    
    <!-- 11. SECCI√ìN: GESTI√ìN DE JOURNEYS -->
    <div id="gestion-journeys-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>  
            <div class="header-actions">
                <button id="refreshJourneysTableBtn" class="action-button">Refrescar</button>
                <button id="getCommunicationsBtn" class="action-button activate-btn" disabled>Comunicaciones</button>
                <button id="drawJourneyBtn" class="action-button" disabled>Dibujar</button>
                <button id="copyJourneyBtn" class="action-button" disabled>Copiar</button>
                <button id="stopJourneyBtn" class="action-button delete-btn" disabled>Parar</button>
            </div>          
        </div>
        <h2>Gesti√≥n de Journeys</h2>
        <!-- Filtros para la tabla de journeys -->
        <div class="header-filters">
            <input type="text" id="journeyNameFilter" class="filter-input" placeholder="Buscar por nombre...">
            <select id="journeyTypeFilter" class="filter-input">
                <option value="">Todos los tipos</option>
                <!-- Opciones se cargar√°n din√°micamente -->
            </select>
            <select id="journeyStatusFilter" class="filter-input">
                <option value="">Todos los estados</option>
                <!-- Opciones se cargar√°n din√°micamente -->
            </select>
            <input type="text" id="journeyDEFilter" class="filter-input" placeholder="Buscar por Data Extension...">
        </div>
        <div class="table-container">
          <table id="journeys-table">
            <thead>
              <tr>
                <th class="sortable-header" data-sort-by="name">Nombre Journey</th>
                <th class="sortable-header" data-sort-by="version">Versi√≥n</th>
                <th class="sortable-header" data-sort-by="createdDate">Fecha creaci√≥n</th>
                <th class="sortable-header" data-sort-by="modifiedDate">Fecha modificaci√≥n</th>
                <th class="sortable-header" data-sort-by="eventType">Tipo</th>
                <th class="sortable-header" data-sort-by="status">Estado</th>
                <th class="sortable-header" data-sort-by="location">Ubicaci√≥n</th>
                <th class="sortable-header" data-sort-by="dataExtensionName">Data Extension</th>
                <th class="sortable-header" data-sort-by="hasCommunications">Descargado</th>
                <th class="sortable-header" data-sort-by="emails">Emails</th>
                <th class="sortable-header" data-sort-by="sms">SMSs</th>
                <th class="sortable-header" data-sort-by="pushes">Pushes</th>
              </tr>
            </thead>
            <tbody id="journeys-tbody"></tbody>
          </table>
        </div>
         <div id="pagination-journeys" class="pagination-controls">
          <button id="prevPageBtnJourneys" class="action-button pagination-arrow">&laquo;</button>
          <input type="number" id="pageInputJourneys" class="filter-input page-input" min="1">
          <span id="totalPagesJourneys">/ 1</span>
          <button id="nextPageBtnJourneys" class="action-button pagination-arrow">&raquo;</button>
        </div>
    </div>
  </main> 
  <!-- END: CONTENIDO PRINCIPAL -->

  <!-- ========================================================== -->
  <!-- START: BARRA LATERAL DERECHA (LOG) -->
  <!-- ========================================================== -->
  <aside id="log-sidebar">
    <div class="log-header">
      <h2>Log de Eventos</h2>
      <button id="toggleLogBtn" title="Colapsar/Expandir Log"></button>
    </div>
    <!-- Bloque para mensajes de estado de la aplicaci√≥n -->
    <div id="log-message-block" class="log-block">
      <h4>Mensajes</h4>
      <pre><code id="log-messages">Esperando acciones...</code></pre>
    </div>
    <!-- Bloque para mostrar el cuerpo de las peticiones API -->
    <div id="log-request-block" class="log-block">
      <h4>Llamada API</h4>
      <pre><code id="log-request"></code></pre>
    </div>
    <!-- Bloque para mostrar el cuerpo de las respuestas API -->
    <div id="log-response-block" class="log-block">
      <h4>Respuesta API</h4>
      <pre><code id="log-response"></code></pre>
    </div>
  </aside>
  <!-- END: BARRA LATERAL DERECHA -->

</div>
<!-- END: CONTENEDOR PRINCIPAL -->

<!-- ========================================================== -->
<!-- START: MODAL DE IMPORTACI√ìN DE CAMPOS -->
<!-- ========================================================== -->
<div id="import-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Importar Campos desde Portapapeles</h3>
        <p>Pega aqu√≠ los datos. Las columnas deben ser: <b>Nombre</b>, <b>Tipo</b> y <b>Longitud</b> (opcional).</p>
        <div class="delimiter-selector">
            <label for="delimiter-select">Separador:</label>
            <select id="delimiter-select">
                <option value="tab" selected>Tabulador (Excel)</option>
                <option value="comma">Coma (,)</option>
                <option value="semicolon">Punto y coma (;)</option>
                <option value="other">Otro...</option>
            </select>
            <input type="text" id="custom-delimiter-input" class="hidden" maxlength="1" placeholder="|">
        </div>
        <textarea id="paste-data-area" rows="10" placeholder="Ciudad	Text	50&#10;Email	EmailAddress	254"></textarea>
        <div class="modal-actions">
            <button id="process-paste-btn" class="action-button">A√±adir Campos</button>
            <button id="cancel-paste-btn" class="action-button delete-btn">Cancelar</button>
        </div>
    </div>
</div>
<!-- END: MODAL DE IMPORTACI√ìN -->

<!-- ========================================================== -->
<!-- START: MODAL DE VISUALIZACI√ìN DE FLUJO DE JOURNEY -->
<!-- ========================================================== -->
<div id="journey-flow-modal" class="modal-overlay">
    <div class="modal-content modal-lg"> <!-- A√±adimos una clase para hacerlo m√°s grande -->
        <h3>Flujo del Journey</h3>
        <div class="journey-flow-container">
            <pre id="journey-flow-content">Cargando flujo...</pre>
        </div>
        <div class="modal-actions">
            <button id="copyFlowBtn" class="action-button">Copiar</button>
            <button id="close-flow-btn" class="action-button">Cerrar</button>
        </div>
    </div>
</div>
<!-- END: MODAL DE FLUJO -->

<!-- ========================================================== -->
<!-- START: MODAL DE ALERTA PERSONALIZADO -->
<!-- ========================================================== -->
<div id="custom-alert-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Aviso</h3>
        <p id="custom-alert-message" style="line-height: 1.6;"></p>
        <div class="modal-actions" style="margin-top: 20px;">
            <button id="custom-alert-close-btn" class="action-button">Aceptar</button>
        </div>
    </div>
</div>
<!-- END: MODAL DE ALERTA -->


<!-- ========================================================== -->
<!-- START: MODAL DE CONFIRMACI√ìN PERSONALIZADO -->
<!-- ========================================================== -->
<div id="custom-confirm-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Confirmaci√≥n Requerida</h3>
        <p id="custom-confirm-message" style="line-height: 1.6;"></p>
        <div class="modal-actions" style="margin-top: 20px;">
            <button id="custom-confirm-cancel-btn" class="action-button delete-btn">Cancelar</button>
            <button id="custom-confirm-ok-btn" class="action-button activate-btn">Confirmar</button>
        </div>
    </div>
</div>
<!-- END: MODAL DE CONFIRMACI√ìN -->
 
<!-- Enlaza el fichero JavaScript al final del body para un rendimiento √≥ptimo -->
<script src="ui.js"></script>
</body>
</html>