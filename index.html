<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Marketing Cloud API Helper</title>
  <!-- Enlaza la hoja de estilos CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Contenedor principal de la aplicaci√≥n con layout de rejilla (grid) -->
<div class="app-container">
  
  <!-- ========================================================== -->
  <!-- START: BARRA LATERAL IZQUIERDA (FUNCIONALIDADES) -->
  <!-- ========================================================== -->
  <aside id="macros-sidebar">
    <!-- Selector de Cliente -->
    <div class="sidebar-client-selector">
      <h2>Cliente</h2>
      <select id="sidebarClientSelect">
        <option value="">Ninguno seleccionado</option>
      </select>
      <!-- INDICADOR DE ESTADO DE LOGIN (NUEVO) -->
      <p id="login-status" class="login-status inactive">üî¥ Sesi√≥n no iniciada</p>
    </div>
    
    <h2>Vistas</h2>
    
    <!-- Men√∫s colapsables para agrupar funcionalidades -->
    <div class="collapsible-group">
        <h3 class="collapsible-header">General</h3>
        <ul class="collapsible-content">
          <li><a class="macro-item" data-macro="docu">Documentaci√≥n</a></li>
          <li><a class="macro-item" data-macro="configuracionAPIs">Configuraci√≥n de APIs</a></li>
        </ul>
    </div>

    <div class="collapsible-group">
        <h3 class="collapsible-header">Data Extensions</h3>
        <ul class="collapsible-content">
          <li><a class="macro-item" data-macro="configuracionDE">Configuraci√≥n de Data Extension</a></li>
          <li><a class="macro-item" data-macro="campos">Campos</a></li>
          <li><a class="macro-item" data-macro="gestionCampos">Gesti√≥n de Campos</a></li>
        </ul>
    </div>

    <div class="collapsible-group">
        <h3 class="collapsible-header">Funcionalidades</h3>
        <ul class="collapsible-content">
          <li><a class="macro-item" data-macro="calendario">Calendario</a></li>
          <li><a class="macro-item" data-macro="validadorEmail">Validador de Email</a></li>
          <li><a class="macro-item" data-macro="buscadores">Buscadores</a></li>
          <li><a class="macro-item" data-macro="gestionAutomatismos">Gesti√≥n de automatismos</a></li> 
        </ul>
    </div>
  </aside>
  <!-- END: BARRA LATERAL IZQUIERDA -->

  <!-- ========================================================== -->
  <!-- START: CONTENIDO PRINCIPAL (CENTRO) -->
  <!-- ========================================================== -->
  <main id="main-content">
    
    <!-- Pantalla de Bienvenida / Men√∫ Principal -->
    <div id="main-menu" class="main-menu-container" style="display: flex;">
      <div class="menu-group">
        <h3>Panel Principal</h3>
        <div class="menu-buttons-container">
         <p class="info-text">
            Bienvenido a Marketing Cloud API Helper.
         </p>
         <p class="info-text">
            Para empezar, configura un cliente en "Configuraci√≥n de APIs". Al pulsar en login (o seleccion√°ndolo si ya estaba guardado) se iniciar√° el proceso de autenticaci√≥n.
         </p>
        </div>
      </div>
    </div>

    <!-- SECCI√ìN: Documentaci√≥n -->
    <div id="documentacion-section" class="section">
      <div class="section-header"><button class="back-button">‚Üê Atr√°s</button></div>
      <h2>Documentaci√≥n</h2>
      <div class="tabs-container">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="configuracion-principal">Configuraci√≥n Principal</button>
          <button class="tab-button" data-tab="guia-rapida">Gu√≠a R√°pida</button>
          <button class="tab-button" data-tab="errores-comunes">Errores Comunes</button>
          <button class="tab-button" data-tab="comentarios-adicionales">Comentarios Adicionales</button>
        </div>
        <!-- Contenido de las Pesta√±as -->
        <div id="configuracion-principal" class="tab-content active">
          <h3>Configuraci√≥n Principal</h3>
          <ul>
            <li><strong>Configurar aplicaci√≥n en MC.</strong>. 
              <ul>
                <li>Entrar en Setup ‚Üí Apps ‚Üí Installed Packages</li>
                <li>Crear un nuevo paquete de tipo <b>Web App</b></li>
                <li>Configurar el callback URI como <b>https://127.0.0.1:8443/callback</b></li>
                <li>Indicar los siguientes permisos en la aplicaci√≥n 
                  <ul>
                    <li>Email: Read/Write</li>
                    <li>Automations: Read/Write/Execute</li>  
                    <li>Journeys: Read</li>    
                    <li>Audiences: Read/Write</li>  
                    <li>Contact to Business Unit Mapping: View</li>  
                    <li>List and Subscribers: Read/Write</li>  
                    <li>Data Extensions: Read/Write</li>              
                  </ul>
                </li>
                <li>Indicar el siguiente permiso a nivel de Usuario:  ‚ÄúEmail > Content > Email > View‚Äù.
              </ul>
            </li>
            <li><strong>Configurar un Cliente:</strong> Ve a <em>Configuraci√≥n de APIs</em>. Introduce un nombre, rellena los datos de la app de MC (MID, Auth URI, etc.) y pulsa "Login / Guardar". 
              Saltar√° una ventana donde iniciar sesi√≥n en Marketing Cloud. Una vez introducidas las credenciales la aplicaci√≥n tardar√° un poco en cerrar la ventana que indicar√° (No responde) <b>Es normal</b></li>
            <li><strong>Almacenamiento Local:</strong> La configuraci√≥n (sin el Client Secret) se guarda en el navegador. Otra parte se guarda en el gestor de credenciales de Windows</li>
            <li><strong>Gesti√≥n de Sesi√≥n:</strong> El bot√≥n "Login" inicia la autenticaci√≥n y guarda la configuraci√≥n. El bot√≥n "Logout" cierra la sesi√≥n activa y elimina la configuraci√≥n guardada.</li>
            <li><strong>Estado de la Sesi√≥n:</strong> El indicador de color bajo el selector de cliente te informa si la sesi√≥n est√° activa o no.</li>
            <li><strong>Inicio:</strong> La aplicaci√≥n se abrir√° sin ningun cliente. </li>
          </ul>
        </div>
        <div id="guia-rapida" class="tab-content">
          <h3>Gu√≠a R√°pida de Funcionalidades</h3>
          <ol>
              <li><b>Configuraci√≥n de DE:</b> Define nombre, descripci√≥n, carpeta y si es Sendable.</li>
              <li><b>Campos:</b> A√±ade campos manualmente, con el bot√≥n de ejemplo o importando desde el portapapeles indicando el separador</li>
              <li><b>Crear DE / Campos:</b> Usa los botones "Crear Data Extension" o "Crear/Actualizar Campos" para ejecutar la acci√≥n.</li>
              <li><b>Gesti√≥n de Campos:</b> Recupera o borra campos de una DE existente. Especialmente √∫til para campos en Attribute Groups que no se pueden borrar por pantalla.</li>
              <li><b>Calendario:</b> Refresca los datos para ver las automatizaciones de Journeys programadas. Los d√≠as con algun automatismo programado aparecer√°n en azul. Seleccionandolo aparecer√° el listado.</li>
              <li><b>Validador de Emails:</b> Valida el mail indicado contra los validadores que utiliza Marketing Cloud para los campos de email.</li>
              <li><b>Buscadores:</b> Permite buscar Data Extensions, el origen de sus datos, queries en base a un texto de su contenido y clientes (con sus envios y Journeys en los que se encuentra).</li>
          </ol>
        </div>
        <div id="errores-comunes" class="tab-content">
            <h3>Errores Comunes</h3>
            <ul>
                <li><strong>Error de autenticaci√≥n:</strong> Revisa que el MID, Client ID y Client Secret sean correctos. La app API debe ser de tipo <b>"Web App"</b>.</li>
                <li><strong>La DE se crea en la ra√≠z:</strong> Para carpetas, debes usar el <strong>ID de la Carpeta</strong> (un n√∫mero), no su nombre.</li>
                <li><strong>DE Sendable sin Subscriber Key:</strong> Es <strong>obligatorio</strong> seleccionar un campo como Subscriber Key y que este sea requerido.</li>
                <li><strong>Error "Bad Request" con enlaces:</strong> Si pegas una URL en un campo con "&", reempl√°zalo por <code>&amp;amp;</code> en la tabla.</li>
            </ul>
        </div>
        <div id="comentarios-adicionales" class="tab-content">
            <h3>Comentarios Adicionales</h3>
            <ul>
              <li><strong>Permisos de la App API:</strong> Aseg√∫rate de que la aplicaci√≥n en MC tiene permisos de Lectura y Escritura para Data Extensions, Automatizaciones y Email.</li>
              <li><strong>"Crear campos" es un "upsert":</strong> Actualiza campos existentes o crea nuevos si no existen.</li>
              <li><strong>Longitud en Decimales:</strong> Usa el formato "total,decimales", por ejemplo, <code>18,2</code>.</li>
            </ul>
        </div>
      </div>
    </div>
    
    <!-- SECCI√ìN: Calendario de Automatizaciones (CORREGIDO) -->
    <div id="calendario-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
             <div class="calendar-controls">
                <label for="calendarYearSelect">A√±o:</label>
                <select id="calendarYearSelect"></select>
                <button id="refreshAutomationsBtn" class="action-button">Refrescar Datos</button>
                <button id="refreshJourneyAutomationsBtn" class="action-button activate-btn">Refrescar Datos Journeys</button>
            </div>
        </div>
        <div class="calendar-container">
            <div id="calendar-main" class="calendar-main-view">
                <h2>Calendario de Automatizaciones de Journeys</h2>
                <div id="calendar-grid" class="calendar-grid"></div>
            </div>
            <aside id="calendar-sidebar" class="calendar-sidebar">
                <h3 id="automation-list-header">Automatizaciones del D√≠a</h3>
                <div id="automation-list">
                    <p>Selecciona un d√≠a para ver los detalles.</p>
                </div>
            </aside>
        </div>
    </div>

    <!-- SECCI√ìN: Buscadores -->
    <div id="buscadores-section" class="section">
      <div class="section-header"><button class="back-button">‚Üê Atr√°s</button></div>
      <h2>Buscadores</h2>
      <div class="tabs-container">
        <!-- Pesta√±as de Navegaci√≥n -->
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="busqueda-de-tab">Data Extensions</button>
          <button class="tab-button" data-tab="origenes-tab">Or√≠gen de datos</button>
          <button class="tab-button" data-tab="clientes-tab">Clientes</button>
          <button class="tab-button" data-tab="queries-tab">Texto en Queries</button>
        </div>

        <!-- Contenido de la Pesta√±a: B√∫squeda de Data Extension -->
        <div id="busqueda-de-tab" class="tab-content active config-section-container">
              <div class="config-block">
                  <h3>Par√°metros de B√∫squeda</h3>
                  <div class="form-group">
                    <label for="deSearchProperty">Buscar por:</label>
                    <select id="deSearchProperty">
                      <option value="Name">Nombre</option>
                      <option value="CustomerKey">External Key</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="deSearchValue">Valor:</label>
                    <input type="text" id="deSearchValue" placeholder="Ingresa el valor de b√∫squeda" maxlength="128">
                  </div>
                  <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="searchDEBtn" class="action-button">Buscar</button>
                  </div>
              </div>
              <div class="config-block">
                  <h3>Resultados</h3>
                  <pre id="de-search-results">La ruta de la Data Extension aparecer√° aqu√≠.</pre>
              </div>
        </div>

        <!-- Contenido de la Pesta√±a: Buscador de Or√≠genes -->
        <div id="origenes-tab" class="tab-content config-section-container">
              <div class="config-block">
                  <h3>Par√°metros de B√∫squeda</h3>
                  <div class="form-group">
                    <label for="deNameToFind">Nombre de la Data Extension:</label>
                    <input type="text" id="deNameToFind" placeholder="Introduce el nombre exacto de la DE">
                  </div>
                  <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="findDataSourcesBtn" class="action-button">Buscar Or√≠genes</button>
                  </div>
              </div>
              <div class="config-block" style="flex-grow: 1; display: flex; flex-direction: column;">
                  <h3>Actividades Encontradas</h3>
                  <div class="table-container" style="flex-grow: 1; overflow-y: auto;">
                      <table id="data-sources-table">
                          <thead>
                              <tr>
                                  <th>Actividad</th><th>Tipo</th><th>Automatizaci√≥n</th>
                                  <th>Paso</th><th>Acci√≥n</th><th>Descripci√≥n / Query</th>
                              </tr>
                          </thead>
                          <tbody id="data-sources-tbody"></tbody>
                      </table>
                  </div>
              </div>
        </div>
        
        <!-- Contenido de la Pesta√±a: Buscador de Clientes -->
        <div id="clientes-tab" class="tab-content config-section-container">
              <div class="config-block">
                  <h3>Par√°metros de B√∫squeda</h3>
                  <div class="form-group">
                    <label for="customerSearchValue">Buscar por ID o Email:</label>
                    <input type="text" id="customerSearchValue" placeholder="Ingresa el Subscriber Key o el Email">
                  </div>
                  <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                    <button id="searchCustomerBtn" class="action-button">Buscar Cliente</button>
                  </div>
              </div>
              <div class="config-block" style="flex-grow: 1; display: flex; flex-direction: column;">
                  <div class="config-block-header">
                      <h3>Resultados</h3>
                      <div class="header-actions">
                          <button id="getCustomerSendsBtn" class="action-button" disabled>Env√≠os</button>
                          <button id="getCustomerJourneysBtn" class="action-button" disabled>Journeys</button>
                      </div>
                  </div>
                  <div class="table-container" style="flex-grow: 1; overflow-y: auto;">
                      <table id="customer-search-table">
                          <thead>
                              <tr>
                                  <th>Subscriber Key</th>
                                  <th>Email</th>
                                  <th>Estado</th>
                                  <th>Fecha Creaci√≥n</th>
                                  <th>Fecha Baja</th>
                                  <th>Suscriptor</th>
                              </tr>
                          </thead>
                          <tbody id="customer-search-tbody"></tbody>
                      </table>
                  </div>
              </div>
              <div id="customer-journeys-results-block" class="config-block hidden">
                  <h3>Journeys del Cliente Seleccionado</h3>
                  <div class="table-container" style="flex-grow: 1; overflow-y: auto;">
                      <table id="customer-journeys-table">
                          <thead>
                              <tr>
                                  <th>Nombre del Journey</th>
                                  <th>ID del Journey</th>
                                  <th>Definition Key</th>
                                  <th>Versi√≥n</th>
                                  <th>Fecha Creaci√≥n</th>
                                  <th>Fecha Modificaci√≥n</th>
                              </tr>
                          </thead>
                          <tbody id="customer-journeys-tbody"></tbody>
                      </table>
                  </div>
              </div>
              <!-- Bloque para los resultados de Env√≠os -->
              <div id="customer-sends-results-block" class="config-block hidden" ...>
                <h3>Env√≠os del Cliente Seleccionado</h3>
                
                <!-- Contenedor para la tabla de Env√≠os (Sent) -->
                <div class="sends-dataview-block">
                    <h4>Enviados (Sent)</h4>
                    <div id="sends-table-container" class="table-container" style="padding-right: 0;"></div>
                </div>
                
                <!-- Contenedor para la tabla de Aperturas (Open) -->
                <div class="sends-dataview-block">
                    <h4>Aperturas (Open)</h4>
                    <div id="opens-table-container" class="table-container" style="padding-right: 0;"></div>
                </div>

                <!-- Contenedor para la tabla de Clics (Click) -->
                <div class="sends-dataview-block">
                    <h4>Clics (Click)</h4>
                    <div id="clicks-table-container" class="table-container" style="padding-right: 0;"></div>
                </div>

                <!-- Contenedor para la tabla de Rebotes (Bounce) -->
                <div class="sends-dataview-block">
                    <h4>Rebotes (Bounce)</h4>
                    <div id="bounces-table-container" class="table-container" style="padding-right: 0;"></div>
                </div>
            </div>
        </div>

        <!-- Contenido de la Pesta√±a: Buscador de Queries -->
        <div id="queries-tab" class="tab-content config-section-container">
          <h2>Buscador de Texto en Queries</h2>
          <div class="config-block">
              <h3>Par√°metros de B√∫squeda</h3>
              <div class="form-group">
                <label for="querySearchText">Texto a buscar en la Query:</label>
                <input type="text" id="querySearchText" placeholder="Ej: _Subscribers o Nombre_DE">
              </div>
              <div class="form-group checkbox-group" style="justify-content: flex-start; padding-left: 5px; margin-top: 10px;">
                  <label for="showQueryTextCheckbox">Mostrar Query Text:</label>
                  <input type="checkbox" id="showQueryTextCheckbox" checked>
              </div>
              <div class="header-actions" style="justify-content: center; margin-top: 20px;">
                <button id="searchQueriesByTextBtn" class="action-button">Buscar en Queries</button>
              </div>
          </div>
          <div class="config-block" style="flex-grow: 1; display: flex; flex-direction: column;">
              <h3>Queries Encontradas</h3>
              <div class="table-container" style="flex-grow: 1; overflow-y: auto;">
                  <table id="query-search-results-table">
                      <thead>
                          <tr>
                              <th>Nombre de la Query</th>
                              <th>Automatizaci√≥n</th>
                              <th>Paso</th>
                              <th>Query Text</th>
                          </tr>
                      </thead>
                      <tbody id="query-search-results-tbody"></tbody>
                  </table>
              </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SECCI√ìN: Configuraci√≥n de APIs -->
    <div id="configuracion-apis-section" class="section config-section-container">
         <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions">
                <button id="saveConfigBtn" class="action-button">Guardar</button>
                <button id="loginBtn" class="action-button">Login</button>
                <button id="logoutBtn" class="action-button delete-btn">Logout / Borrar</button>
            </div>            
        </div>
        <h2>Configuraci√≥n de APIs</h2>
        <div class="client-management">
            <input type="text" id="clientName" placeholder="Nombre del Cliente">
            <select id="savedConfigs"></select>
        </div>
        <div class="config-block">
            <h3>Datos Aplicaci√≥n</h3>
            <div class="form-group"><label for="businessUnit">Business Unit (MID)</label><input type="text" id="businessUnit"></div>
            <div class="form-group"><label for="authUri">Auth URI</label><input type="text" id="authUri"></div>
            <div class="form-group"><label for="clientId">Client ID</label><input type="text" id="clientId"></div>
            <div class="form-group"><label for="clientSecret">Client Secret</label><input type="password" id="clientSecret" placeholder="Necesario para el primer login"></div>
            <div class="form-group"><label for="token">Token</label><input type="text" id="token" disabled></div>
            <div class="form-group"><label for="soapUri">SOAP URI</label><input type="text" id="soapUri" disabled></div>
            <div class="form-group"><label for="restUri">REST URI</label><input type="text" id="restUri" disabled></div>
             <div class="form-group"><label for="stackKey">Stack</label><input type="text" id="stackKey" disabled></div>
        </div>
         <div class="config-block">
            <h3>Data Views</h3>
            <p class="info-text" style="text-align: left; margin: 0 0 15px;">
                Introduce la <strong>External Key completa</strong> de las Data Views de tracking de env√≠os.
            </p>
            <div class="form-group"><label for="dvSent">Sent</label><input type="text" id="dvSent" placeholder="Ej: DataView_Sent_ClienteX"></div>
            <div class="form-group"><label for="dvOpen">Open</label><input type="text" id="dvOpen" placeholder="Ej: _Open"></div>
            <div class="form-group"><label for="dvClick">Click</label><input type="text" id="dvClick" placeholder="Ej: _Click"></div>
            <div class="form-group"><label for="dvBounce">Bounce</label><input type="text" id="dvBounce" placeholder="Ej: _Bounce"></div>
        </div>
        <p class="info-text">Usa 'Login / Guardar' para iniciar sesi√≥n y guardar la configuraci√≥n. 'Logout / Borrar' elimina toda la informaci√≥n y la sesi√≥n. El Client Secret se usa para el login pero no se guarda en el almacenamiento local.</p>
    </div>

    <!-- SECCI√ìN: Configuraci√≥n de Data Extension -->
    <div id="configuracion-de-section" class="section config-section-container">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions"><button id="createDE" class="action-button">Crear Data Extension</button></div>
        </div>
        <h2>Configuraci√≥n de Data Extension</h2>
        <div class="config-block">
            <h3>Configuraci√≥n Base</h3>
            <div class="form-group"><label for="deName">Nombre Data Extension</label><input type="text" id="deName"></div>
            <div class="form-group"><label for="deDescription">Descripci√≥n</label><input type="text" id="deDescription"></div>
            <div class="form-group"><label for="deExternalKey">External Key</label><input type="text" id="deExternalKey" disabled></div>
            <div class="form-group"><label for="deFolder">ID de Carpeta (Opcional)</label><input type="text" id="deFolder" placeholder="Ej: 12345"></div>
        </div>
        <div class="config-block">
            <h3>Configuraci√≥n Sendable</h3>
            <div class="form-group checkbox-group">
                <label for="isSendable">Es Sendable:</label><input type="checkbox" id="isSendable">
            </div>
            <div class="form-group">
                <label for="subscriberKeyField">Campo SubscriberKey</label>
                <select id="subscriberKeyField" disabled><option value="">-- Defina campos en la secci√≥n 'Campos' --</option></select>
            </div>
            <div class="form-group"><label for="subscriberKeyType">Tipo Campo SubscriberKey</label><input type="text" id="subscriberKeyType" disabled></div>
        </div>
    </div>
        

    <!-- SECCI√ìN: Validador de Email (CORREGIDO) -->
    <div id="email-validator-section" class="section config-section-container">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
        </div>
        <h2>Validador de Email</h2>
        <div class="config-block">
            <h3>Par√°metros de Validaci√≥n</h3>
            <div class="form-group">
              <label for="emailToValidate">Email a validar:</label>
              <input type="text" id="emailToValidate" placeholder="Introduce la direcci√≥n de email">
            </div>
            <div class="header-actions" style="justify-content: center; margin-top: 20px;">
               <button id="validateEmailBtn" class="action-button">Validar Email</button>
            </div>
        </div>
        <div class="config-block">
            <h3>Resultado de la Validaci√≥n</h3>
            <pre id="email-validation-results">El resultado aparecer√° aqu√≠.</pre>
        </div>
    </div>
       

    <!-- SECCI√ìN: Gesti√≥n de Campos -->
    <div id="configuracion-campos-section" class="section config-section-container">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions">
                <button id="getFields" class="action-button">Recuperar Campos</button>
                <button id="deleteField" class="action-button delete-btn">Borrar Campo</button>
            </div>
        </div>
        <h2>Gesti√≥n de Campos de Data Extension</h2>
        <div class="config-block">
            <h3>Par√°metros</h3>
            <p class="info-text" style="text-align: left; margin: 0 0 15px;">
                Introduce la External Key de la DE sobre la que quieres operar.
            </p>
            <div class="form-group">
                <label for="recExternalKey">External Key de la DE</label>
                <input type="text" id="recExternalKey">
            </div>
            <div class="form-group">
                <label for="targetFieldSelect">Campo a eliminar</label>
                <select id="targetFieldSelect" disabled><option value="">-- Pulsa "Recuperar Campos" para poblar --</option></select>
            </div>
        </div>
    </div>

    <!-- SECCI√ìN: Campos de la Data Extension -->
    <div id="campos-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>
            <div class="header-actions">
                <button id="importFieldsBtn" class="action-button">Importar...</button>
                <button id="addFieldBtn" class="action-button">A√±adir Fila</button>
                <button id="createFieldsBtn" class="action-button">Crear/Actualizar Campos</button>
                <button id="createDummyFieldsBtn" class="action-button">Campos de Ejemplo</button>                
                <button id="clearFieldsBtn" class="action-button delete-btn">Limpiar Tabla</button>
            </div>
        </div>
        <h2>Campos de la Data Extension</h2>
        <div class="table-container">
          <table id="myTable">
            <thead>
              <tr><th>Campo MC</th><th>Tipo Campo</th><th>Longitud</th><th>Default</th><th>PK</th><th>Requerido</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="control-buttons">
            <button id="moveUp" title="Mover fila seleccionada hacia arriba">Subir</button>
            <button id="moveDown" title="Mover fila seleccionada hacia abajo">Bajar</button>
          </div>
        </div>
    </div>

     <!-- SECCI√ìN: Gesti√≥n de Automatismos (NUEVA) -->
    <div id="gestion-automatismos-section" class="section">
        <div class="section-header">
            <button class="back-button">‚Üê Atr√°s</button>            
            <div class="header-actions">
                <button id="refreshAutomationsTableBtn" class="action-button">Refrescar</button>
                <button id="activateAutomationBtn" class="action-button activate-btn" disabled>Activar</button>
                <button id="runAutomationBtn" class="action-button" disabled>Ejecutar</button>
                <button id="stopAutomationBtn" class="action-button delete-btn" disabled>Parar</button>
            </div>
        </div>
        <h2>Gesti√≥n de Automatismos</h2>
        <div class="header-filters">
            <input type="text" id="automationNameFilter" class="filter-input" placeholder="Buscar por nombre...">
            <select id="automationStatusFilter" class="filter-input">
                <option value="">Todos los estados</option>
                <!-- Las opciones se generar√°n con JavaScript -->
            </select>
        </div>
        <div class="table-container" style="padding-right: 0;"> <!-- Quitamos el padding para que la tabla ocupe todo el ancho -->
          <table id="automations-table">
            <thead>
              <tr>
                <th class="sortable-header" data-sort-by="name">Nombre</th>
                <th class="sortable-header" data-sort-by="lastRunTime">√öltima Ejecuci√≥n</th>
                <th class="sortable-header" data-sort-by="schedule.scheduledTime">Pr√≥xima Ejecuci√≥n</th>
                <th class="sortable-header" data-sort-by="status">Estado</th>
              </tr>
            </thead>
            <tbody id="automations-tbody">
                <!-- El contenido se generar√° con JavaScript -->
            </tbody>
          </table>
        </div>
    </div>
    
  </main> 
  <!-- END: CONTENIDO PRINCIPAL -->

  <!-- ========================================================== -->
  <!-- START: BARRA LATERAL DERECHA (LOG) -->
  <!-- ========================================================== -->
  <aside id="log-sidebar">
    <div class="log-header">
      <h2>Log de Eventos</h2>
      <button id="toggleLogBtn" title="Colapsar/Expandir Log"></button>
    </div>
    <div id="log-message-block" class="log-block">
      <h4>Mensajes</h4>
      <pre><code id="log-messages">Esperando acciones...</code></pre>
    </div>
    <div id="log-request-block" class="log-block">
      <h4>Llamada API</h4>
      <pre><code id="log-request"></code></pre>
    </div>
    <div id="log-response-block" class="log-block">
      <h4>Respuesta API</h4>
      <pre><code id="log-response"></code></pre>
    </div>
  </aside>
  <!-- END: BARRA LATERAL DERECHA -->

</div>
<!-- END: CONTENEDOR PRINCIPAL -->

<!-- ========================================================== -->
<!-- START: MODAL DE IMPORTACI√ìN -->
<!-- ========================================================== -->
<div id="import-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Importar Campos desde Portapapeles</h3>
        <p>Pega aqu√≠ los datos. Las columnas deben ser: <b>Nombre</b>, <b>Tipo</b> y <b>Longitud</b> (opcional).</p>
        <div class="delimiter-selector">
            <label for="delimiter-select">Separador:</label>
            <select id="delimiter-select">
                <option value="tab" selected>Tabulador (Excel)</option>
                <option value="comma">Coma (,)</option>
                <option value="semicolon">Punto y coma (;)</option>
                <option value="other">Otro...</option>
            </select>
            <input type="text" id="custom-delimiter-input" class="hidden" maxlength="1" placeholder="|">
        </div>
        <textarea id="paste-data-area" rows="10" placeholder="Ciudad	Text	50&#10;Email	EmailAddress	254"></textarea>
        <div class="modal-actions">
            <button id="process-paste-btn" class="action-button">A√±adir Campos</button>
            <button id="cancel-paste-btn" class="action-button delete-btn">Cancelar</button>
        </div>
    </div>
</div>
<!-- END: MODAL DE IMPORTACI√ìN -->

<!-- Enlaza el fichero JavaScript al final del body para un rendimiento √≥ptimo -->
<script src="ui.js"></script>
</body>
</html>