<!DOCTYPE html>
<html>
<head>
<title>Marketing Cloud API Helper</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">
  
  <!-- COLUMNA IZQUIERDA: MACROS -->
  <aside id="macros-sidebar">
	<div class="sidebar-client-selector">
	  <h2>Cliente</h2>
      <select id="sidebarClientSelect">
        <option value="">Ninguno seleccionado</option>
      </select>
	</div>
    <h2>Macros</h2>
    
    <h3>Administración</h3>
    <ul>
      <li><a class="macro-item" data-macro="getToken">Recuperar Token</a></li>
    </ul>

    <h3>Data Extensions</h3>
    <ul>
      <li><a class="macro-item" data-macro="createDE">Crear Data Extension</a></li>
      <li><a class="macro-item" data-macro="upsertRows">Crear/Actualizar Registros</a></li>
      <li><a class="macro-item" data-macro="createDEAndRows">Crear Data Extension y Registros</a></li>
    </ul>

    <h3>Campos</h3>
    <ul>
      <li><a class="macro-item" data-macro="getFieldIds">Recuperar Ids</a></li>
      <li><a class="macro-item" data-macro="deleteField">Borrar campo</a></li>
      <li><a class="macro-item" data-macro="createFields">Crear campos</a></li>
      <li><a class="macro-item" data-macro="getFields">Recuperar campos</a></li>
    </ul>
  </aside>

  <!-- COLUMNA CENTRAL: CONTENIDO PRINCIPAL -->
  <main id="main-content">
    <!-- Menú Principal -->
    <div id="main-menu" class="main-menu-container" style="display: flex;">
      
      <div class="menu-group">
        <h3>General</h3>
        <div class="menu-buttons-container">
          <button class="menu-button" onclick="showSection('notas-section')">Notas</button>
          <button class="menu-button" onclick="showSection('configuracion-apis-section')">Configuración de APIs</button>
        </div>
      </div>
      
      <div class="menu-group">
        <h3>Data Extensions</h3>
        <div class="menu-buttons-container">
          <button class="menu-button" onclick="showSection('configuracion-de-section')">Configuración de Data Extension</button>
          <button class="menu-button" onclick="showSection('campos-section')">Campos</button>
          <button class="menu-button" onclick="showSection('configuracion-campos-section')">Gestión de Campos</button>
        </div>
      </div>

    </div>

    <!-- Sección de Notas -->
    <div id="notas-section" class="section">
      <button class="back-button">← Atrás</button>
      <h2>Notas Importantes</h2>
      <div class="content">
        <h3>Errores comunes:</h3>
        <ul>
          <li>Si la DE es Sendable, el campo que utilicéis como SubscriberKey tiene que tener el check de obligatorio marcado.</li>
          <li>Si queremos crear una DE en una BU hija, es necesario indicar la BU y el identificador de la carpeta. Si no se indica la carpeta, la añade en Data Extensions.</li>
          <li>La aplicación se debe crear en la BU Root. De no hacerlo, aunque se de permisos para otra BU devuelve un error.</li>
          <li>Si ya está creada una DE con un nombre concreto y le volvéis a dar a crear, os va a devolver un error porque la DE ya existe.</li>
          <li>Si da error intentando crear la DE en una BU hija, aseguraos de que la aplicación es accesible desde esa BU. Para eso se dan "licencias" desde la propia aplicación.</li>
          <li>Para la creación de registros mucho cuidado con el formato de los campos de fecha. Podéis consultar los formatos válidos <a href="https://help.salesforce.com/articleView?id=admin_supported_date_time_format.htm&type=5" target="_blank">aquí</a>. El formato debería ser YYYY/DD/MM.</li>
          <li>Los decimales deben ir con punto a la hora de crear registros.</li>
          <li>A la hora de pasar un enlace a un campo de texto que contenga un "&", es necesario transformarlo a "&amp;" o dará un error de Bad Request.</li>
        </ul>
        <h3>Comentarios adicionales:</h3>
        <ul>
          <li>La configuración de la plantilla tiene las credenciales de la instancia de pruebas. Revisad la BU en la que se está creando la DE porque puede haberlo modificado otra persona.</li>
          <li>No dejéis nunca en la plantilla credenciales de una instancia de cliente.</li>
          <li>Pulsando el botón MC API > Restablecer credenciales de instancia de pruebas dejaréis las credenciales de pruebas.</li>
          <li>Tenéis capado todos los campos que no tenéis que tocar, pero si clonais la plantilla podréis tocarlos.</li>
          <li>Aunque en la pestaña de configuración aparece un ejemplo, la aplicación que se debe crear es del tipo API Integration y dentro de esta Server to Server.</li>
          <li>Si la app creada solo se va a utilizar para la creación de Data Extensions, solo es necesario dar los permisos correspondientes al uso de Data Extensions (Read Write Data Extension).</li>
          <li>Para crear una Data Extension, además de la configuración, en la pestaña de Campos solo es necesario informar las siguientes columnas: Campo MC, Tipo Campo, Longitud, PK y Obligatorio.</li>
          <li>La parte de Salesforce solo es para cuando vamos a construir el automatismo de Contactables y ya tenemos esto documentado en un documento de diseño. De esta forma, en la columna Query ya tendremos lo que hay que copiar y pegar en la query para obtener la transformación de las etiquetas.</li>
        </ul>
      </div>
    </div>
    
    <!-- Sección de Configuración de APIs (Antes parte de Configuración) -->
    <div id="configuracion-apis-section" class="section config-section-container">
        <button class="back-button">← Atrás</button>
        <h2>Configuración de APIs</h2>
        <div class="client-management">
            <input type="text" id="clientName" placeholder="Nombre del Cliente">
            <select id="savedConfigs"></select>
            <button id="saveConfig">Guardar</button>
            <button id="deleteConfig" class="delete-btn">Borrar</button>
        </div>
        <div class="config-block">
            <h3>Datos Aplicación</h3>
            <div class="form-group"><label for="businessUnit">Business Unit (MID)</label><input type="text" id="businessUnit"></div>
            <div class="form-group"><label for="authUri">Auth URI</label><input type="text" id="authUri"></div>
            <div class="form-group"><label for="clientId">Client ID</label><input type="text" id="clientId"></div>
            <div class="form-group"><label for="clientSecret">Client Secret</label><input type="text" id="clientSecret"></div>
            <div class="form-group"><label for="token">Token</label><input type="text" id="token" disabled></div>
            <div class="form-group"><label for="soapUri">SOAP URI</label><input type="text" id="soapUri" disabled></div>
            <div class="form-group"><label for="restUri">REST URI</label><input type="text" id="restUri" disabled></div>
        </div>
        <p class="info-text">
            La configuración se guardará localmente en tu navegador. No se almacena en ningún servidor externo. Al borrarla, se eliminará permanentemente de tu equipo.
        </p>
    </div>

    <!-- Sección de Configuración de Data Extension (Nueva) -->
    <div id="configuracion-de-section" class="section config-section-container">
        <button class="back-button">← Atrás</button>
        <h2>Configuración de Data Extension</h2>
        <div class="config-block">
            <h3>Configuración Base DE</h3>
            <div class="form-group"><label for="deName">Nombre Data Extension</label><input type="text" id="deName"></div>
            <div class="form-group"><label for="deDescription">Descripción</label><input type="text" id="deDescription"></div>
            <div class="form-group"><label for="deExternalKey">External Key</label><input type="text" id="deExternalKey" disabled></div>
            <div class="form-group"><label for="deFolder">Carpeta</label><input type="text" id="deFolder"></div>
        </div>
        <div class="config-block">
            <h3>Configuración Sendable</h3>
            <div class="form-group checkbox-group">
                <label for="isSendable">Sendable DE:</label>
                <input type="checkbox" id="isSendable">
            </div>
            <div class="form-group">
                <label for="subscriberKeyField">Campo SubscriberKey</label>
                <select id="subscriberKeyField" disabled>
                    <option value="">-- Primero defina campos en la sección 'Campos' --</option>
                </select>
            </div>
            <div class="form-group"><label for="subscriberKeyType">Tipo Campo SubscriberKey</label><input type="text" id="subscriberKeyType" disabled></div>
        </div>
    </div>

    <!-- Sección de Configuración de Gestión de Campos (Nueva) -->
    <div id="configuracion-campos-section" class="section config-section-container">
        <button class="back-button">← Atrás</button>
        <h2>Configuración Recuperación/Borrado/Creación de Campos</h2>
        <div class="config-block">
            <div class="form-group">
                <label for="fieldActionSelect">Acción a Realizar</label>
                <select id="fieldActionSelect">
                    <option value="recuperar">Recuperar</option>
                    <option value="borrar">Borrar</option>
                    <option value="crear">Crear</option>
                </select>
            </div>
        </div>
        <div class="config-block">
            <h3>Parámetros</h3>
            <div class="form-group"><label for="recExternalKey">External Key de la DE</label><input type="text" id="recExternalKey" disabled></div>
            <div class="form-group"><label for="deleteFieldName">Nombre del campo a eliminar</label><input type="text" id="deleteFieldName" disabled></div>
            <div class="form-group"><label for="deleteFieldId">Id del campo a eliminar</label><input type="text" id="deleteFieldId" disabled></div>
            <div class="form-group"><label for="recObjectId">Campo - Object Id</label><input type="text" id="recObjectId" disabled></div>
        </div>
    </div>

    <!-- Sección de Campos -->
    <div id="campos-section" class="section">
        <div class="section-header">
            <button class="back-button">← Atrás</button>
            <div class="header-actions">
                <button id="createDummyFieldsBtn" class="action-button">Crear Campos Dummy</button>
                <button id="clearFieldsBtn" class="action-button delete-btn">Limpiar Campos</button>
            </div>
        </div>
        
        <h2>Campos de la Data Extension</h2>
        <div class="table-container">
          <table id="myTable">
            <thead>
              <tr><th>Campo MC</th><th>Tipo Campo</th><th>Longitud</th><th>Default</th><th>PK</th><th>Obligatorio</th></tr>
            </thead>
            <!-- El cuerpo de la tabla empieza vacío -->
            <tbody></tbody>
          </table>
          <div class="control-buttons">
            <button id="addFieldBtn" class="action-button">Añadir Fila</button>
            <button id="moveUp">Subir</button>
            <button id="moveDown">Bajar</button>
          </div>
        </div>
        <div id="selectedValues">
          <h2>Valores de la fila seleccionada:</h2>
          <ul></ul>
        </div>
    </div>
  </main> 

  <!-- COLUMNA DERECHA: LOG -->
  <aside id="log-sidebar">
    <div class="log-header">
      <h2>Log de Eventos</h2>
      <button id="toggleLogBtn" title="Colapsar Log"></button>
    </div>
    <div class="log-block">
      <h4>Llamada</h4>
      <pre><code id="log-request">Esperando acciones...</code></pre>
    </div>
    <div class="log-block">
      <h4>Respuesta</h4>
      <pre><code id="log-response"></code></pre>
    </div>
  </aside>

</div>
<script src="ui.js"></script>
</body>
</html>